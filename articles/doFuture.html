<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Foreach Parallel Adaptor using Futures â€¢ doFuture</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="A Foreach Parallel Adaptor using Futures">
<meta property="og:description" content="doFuture">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SB3EQSD9FR"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB3EQSD9FR');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">doFuture</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.12.0-9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/doFuture.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://www.futureverse.org/" class="external-link">
    <span class="fas fa-fast-backward"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://BiocParallel.FutureParam.futureverse.org" class="external-link">BiocParallel.FutureParam</a>
    </li>
    <li>
      <a href="https://doFuture.futureverse.org">doFuture</a>
    </li>
    <li>
      <a href="https://furrr.futureverse.org" class="external-link">furrr</a>
    </li>
    <li>
      <a href="https://future.futureverse.org" class="external-link">future</a>
    </li>
    <li>
      <a href="https://future.apply.futureverse.org" class="external-link">future.apply</a>
    </li>
    <li>
      <a href="https://future.batchtools.futureverse.org" class="external-link">future.batchtools</a>
    </li>
    <li>
      <a href="https://future.callr.futureverse.org" class="external-link">future.callr</a>
    </li>
    <li>
      <a href="https://future.tests.futureverse.org" class="external-link">future.tests</a>
    </li>
    <li>
      <a href="https://globals.futureverse.org" class="external-link">globals</a>
    </li>
    <li>
      <a href="https://listenv.futureverse.org" class="external-link">listenv</a>
    </li>
    <li>
      <a href="https://parallelly.futureverse.org" class="external-link">parallelly</a>
    </li>
    <li>
      <a href="https://progressr.futureverse.org" class="external-link">progressr</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://cloud.r-project.org/package=doFuture" class="external-link">
    <span class="fab fa-r-project"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/HenrikBengtsson/doFuture/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A Foreach Parallel Adaptor using Futures</h1>
                        <h4 data-toc-skip class="author">Henrik Bengtsson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/HenrikBengtsson/doFuture/blob/master/vignettes/doFuture.md.rsp" class="external-link"><code>vignettes/doFuture.md.rsp</code></a></small>
      <div class="hidden name"><code>doFuture.md.rsp</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The <a href="https://cran.r-project.org/package=future" class="external-link">future</a> package provides a generic API for using futures in R. A future is a simple yet powerful mechanism to evaluate an R expression and retrieve its value at some point in time. Futures can be resolved in many different ways depending on which strategy is used. There are various types of synchronous and asynchronous futures to choose from in the <a href="https://cran.r-project.org/package=future" class="external-link">future</a> package. Additional futures are implemented in other packages. For instance, the <a href="https://cran.r-project.org/package=future.batchtools" class="external-link">future.batchtools</a> package provides futures for <em>any</em> type of backend that the <a href="https://cran.r-project.org/package=batchtools" class="external-link">batchtools</a> package supports. For an introduction to futures in R, please consult the vignettes of the <a href="https://cran.r-project.org/package=future" class="external-link">future</a> package.</p>
<p>The <a href="https://cran.r-project.org/package=doFuture" class="external-link">doFuture</a> package provides a <code>%dopar%</code> adapter for the <a href="https://cran.r-project.org/package=foreach" class="external-link">foreach</a> package that works with <em>any</em> type of future. The doFuture package is cross platform just as the future package.</p>
<p>Below is an example showing how to make <code>%dopar%</code> work with <em>multisession</em> futures. A multisession future will be evaluated in parallel using background R process.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://doFuture.futureverse.org">"doFuture"</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/registerDoFuture.html">registerDoFuture</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span>

<span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="fl">0.10</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mtcars</span>, .export <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cutoff"</span><span class="op">)</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, trim <span class="op">=</span> <span class="va">cutoff</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></code></pre></div>
</div>
<div id="futures-bring-foreach-to-the-hpc-cluster" class="section level2">
<h2 class="hasAnchor">
<a href="#futures-bring-foreach-to-the-hpc-cluster" class="anchor"></a>Futures bring foreach to the HPC cluster</h2>
<p>To do the same on high-performance computing (HPC) cluster, the <a href="https://cran.r-project.org/package=future.batchtools" class="external-link">future.batchtools</a> package can be used. Assuming batchtools has been configured correctly, then following foreach iterations will be submitted to the HPC job scheduler and distributed for evaluation on the compute nodes.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://doFuture.futureverse.org">"doFuture"</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/registerDoFuture.html">registerDoFuture</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">plan</span><span class="op">(</span><span class="fu">future.batchtools</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/future.batchtools/man/batchtools_template.html" class="external-link">batchtools_slurm</a></span><span class="op">)</span>

<span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="fl">0.10</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mtcars</span>, .export <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cutoff"</span><span class="op">)</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, trim <span class="op">=</span> <span class="va">cutoff</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></code></pre></div>
</div>
<div id="futures-for-plyr" class="section level2">
<h2 class="hasAnchor">
<a href="#futures-for-plyr" class="anchor"></a>Futures for plyr</h2>
<p>The <a href="https://cran.r-project.org/package=plyr" class="external-link">plyr</a> package uses <a href="https://cran.r-project.org/package=foreach" class="external-link">foreach</a> as a parallel backend. This means that with <a href="https://cran.r-project.org/package=doFuture" class="external-link">doFuture</a> any type of futures can be used for asynchronous (and synchronous) plyr processing including multicore, multisession, MPI, ad hoc clusters and HPC job schedulers. For example,</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://doFuture.futureverse.org">"doFuture"</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/registerDoFuture.html">registerDoFuture</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://had.co.nz/plyr" class="external-link">"plyr"</a></span><span class="op">)</span>

<span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="fl">0.10</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/llply.html" class="external-link">llply</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">mean</span>, trim <span class="op">=</span> <span class="va">cutoff</span>, .parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">## $a</span>
<span class="co">##  25%  50%  75%</span>
<span class="co">## 3.25 5.50 7.75</span>
<span class="co">##</span>
<span class="co">## $beta</span>
<span class="co">##       25%       50%       75%</span>
<span class="co">## 0.2516074 1.0000000 5.0536690</span>
<span class="co">##</span>
<span class="co">## $logic</span>
<span class="co">## 25% 50% 75%</span>
<span class="co">## 0.0 0.5 1.0</span></code></pre></div>
</div>
<div id="futures-and-biocparallel" class="section level2">
<h2 class="hasAnchor">
<a href="#futures-and-biocparallel" class="anchor"></a>Futures and BiocParallel</h2>
<p>The <a href="https://bioconductor.org/packages/release/bioc/html/BiocParallel.html" class="external-link">BiocParallel</a> package supports any <code>%dopar%</code> adapter as a parallel backend. This means that with <a href="https://cran.r-project.org/package=doFuture" class="external-link">doFuture</a>, BiocParallel supports any type of future. For example,</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://doFuture.futureverse.org">"doFuture"</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/registerDoFuture.html">registerDoFuture</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/Bioconductor/BiocParallel" class="external-link">"BiocParallel"</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/DoparParam-class.html" class="external-link">DoparParam</a></span><span class="op">(</span><span class="op">)</span>, default <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="fl">0.10</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/bplapply.html" class="external-link">bplapply</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">mean</span>, trim <span class="op">=</span> <span class="va">cutoff</span><span class="op">)</span></code></pre></div>
</div>
<div id="dofuture-takes-care-of-exports-and-packages-automatically" class="section level2">
<h2 class="hasAnchor">
<a href="#dofuture-takes-care-of-exports-and-packages-automatically" class="anchor"></a>doFuture takes care of exports and packages automatically</h2>
<p>The foreach package itself has some support for automated handling of globals but unfortunately it does not work in all cases. Specifically, if <code>foreach()</code> is called from within a function, you do need to export globals explicitly. For example, although globals <code>my</code> and <code>sigma</code> are properly exported when we do</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"doParallel"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="fl">0.10</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, trim <span class="op">=</span> <span class="va">cutoff</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></code></pre></div>
<p>it falls short as soon as we try to do the same from within a function;</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, trim <span class="op">=</span> <span class="va">cutoff</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>
  <span class="va">y</span>
<span class="op">}</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">my_mean</span><span class="op">(</span><span class="op">)</span>
<span class="co">## Error in { : task 1 failed - "object 'cutoff' not found"</span></code></pre></div>
<p>The solution is to explicitly export global variables, e.g.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mtcars</span>, .export <span class="op">=</span> <span class="st">"cutoff"</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, trim <span class="op">=</span> <span class="va">cutoff</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>
  <span class="va">y</span>
<span class="op">}</span>

<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">my_mean</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>In contrast, when using the <code>%dopar%</code> adapter of doFuture, all of the <a href="https://cran.r-project.org/package=future" class="external-link">future</a> machinery comes in to play including automatic handling of global variables, e.g.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://doFuture.futureverse.org">"doFuture"</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/registerDoFuture.html">registerDoFuture</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">my_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, trim <span class="op">=</span> <span class="va">cutoff</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>
  <span class="va">y</span>
<span class="op">}</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">my_mean</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>will indeed work.</p>
<p>Another advantage with doFuture is that, contrary to doParallel, packages that need to be attached are also automatically taken care of, e.g.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/registerDoFuture.html">registerDoFuture</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"tools"</span><span class="op">)</span>
<span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"abc.txt"</span>, <span class="st">"def.log"</span><span class="op">)</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_ext</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">ext</span><span class="op">)</span>
<span class="co">## [1] "txt" "log"</span></code></pre></div>
<p>whereas</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"tools"</span><span class="op">)</span>
<span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"abc.txt"</span>, <span class="st">"def.log"</span><span class="op">)</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_ext</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>
<span class="co">## Error in file_ext(file) : </span>
<span class="co">##   task 1 failed - "could not find function "file_ext""</span></code></pre></div>
<p>Having said all this, in order to write foreach code that works everywhere, it is better to be conservative and not assume that all end users will use a doFuture backend. Because of this, it is still recommended to explicitly specify all objects that need to be export whenever using the foreach API. The doFuture framework can help you identify what should go into the <code>.export</code> argument. By setting <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options(doFuture.foreach.export = ".export-and-automatic-with-warning")</a></code>, doFuture will in warn if it finds globals not listed in <code>.export</code> and produce an informative warning message suggesting that those should be added. To assert that argument <code>.export</code> is correct, test the code with <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options(doFuture.foreach.export = ".export")</a></code>, which will disable automatic identification of globals such that only the globals specified by the <code>.export</code> argument is used.</p>
</div>
<div id="dofuture-replaces-existing-donnn-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#dofuture-replaces-existing-donnn-packages" class="anchor"></a>doFuture replaces existing doNnn packages</h2>
<p>Due to the generic nature of futures, the <a href="https://cran.r-project.org/package=doFuture" class="external-link">doFuture</a> package provides the same functionality as many of the existing doNnn packages combined, e.g. <a href="https://cran.r-project.org/package=doMC" class="external-link">doMC</a>, <a href="https://cran.r-project.org/package=doParallel" class="external-link">doParallel</a>, <a href="https://cran.r-project.org/package=doMPI" class="external-link">doMPI</a>, and <a href="https://cran.r-project.org/package=doSNOW" class="external-link">doSNOW</a>.</p>
<table style="width: 100%;" class="table">
<tr>
<th>
doNnn usage
</th>
<th>
doFuture alternative
</th>
</tr>
<tr style="vertical-align: center;">
<td>
<pre><code class="r"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">library("foreach")
registerDoSEQ()

</a></code></pre>
</td>
<td>
<pre><code class="r"><a href="https://doFuture.futureverse.org">library("doFuture")
registerDoFuture()
plan(sequential)
</a></code></pre>
</td>
</tr>
<tr style="vertical-align: center;">
<td>
<pre><code class="r"><a href="https://rdrr.io/r/base/library.html" class="external-link">library("doMC")
registerDoMC()

</a></code></pre>
</td>
<td>
<pre><code class="r"><a href="https://doFuture.futureverse.org">library("doFuture")
registerDoFuture()
plan(multicore)
</a></code></pre>
</td>
</tr>
<tr style="vertical-align: center;">
<td>
<pre><code class="r"><a href="https://rdrr.io/r/base/library.html" class="external-link">library("doParallel")
registerDoParallel()

</a></code></pre>
</td>
<td>
<pre><code class="r"><a href="https://doFuture.futureverse.org">library("doFuture")
registerDoFuture()
plan(multisession)  ## on MS Windows
plan(multicore)     ## on Linux, Solaris, and macOS
</a></code></pre>
</td>
</tr>
<tr style="vertical-align: center;">
<td>
N/A
</td>
<td>
<pre><code class="r"><a href="https://doFuture.futureverse.org">library("doFuture")
registerDoFuture()
plan(future.callr::callr)
</a></code></pre>
</td>
</tr>
<tr style="vertical-align: center;">
<td>
<pre><code class="r"><a href="https://rdrr.io/r/base/library.html" class="external-link">library("doParallel")
cl </a></code></pre>
</td>
<td>
<pre><code class="r"><a href="https://doFuture.futureverse.org">library("doFuture")
registerDoFuture()
cl </a></code></pre>
</td>
</tr>
<tr style="vertical-align: center;">
<td>
<pre><code class="r"><a href="https://rdrr.io/r/base/library.html" class="external-link">library("doMPI")
cl </a></code></pre>
</td>
<td>
<pre><code class="r"><a href="https://doFuture.futureverse.org">library("doFuture")
registerDoFuture()
cl </a></code></pre>
</td>
</tr>
<tr style="vertical-align: center;">
<td>
<pre><code class="r"><a href="https://rdrr.io/r/base/library.html" class="external-link">library("doSNOW")
cl </a></code></pre>
</td>
<td>
<pre><code class="r"><a href="https://doFuture.futureverse.org">library("doFuture")
registerDoFuture()
cl </a></code></pre>
</td>
</tr>
<tr style="vertical-align: center;">
<td>
N/A
</td>
<td>
High-performance compute (HPC) schedulers, e.g. SGE, Slurm, and TORQUE / PBS.
<pre><code class="r"><a href="https://doFuture.futureverse.org">library("doFuture")
registerDoFuture()
plan(future.batchtools::batchtools_sge)
</a></code></pre>
</td>
</tr>
<tr style="vertical-align: center;">
<td>
<pre><code class="r"><a href="https://rdrr.io/r/base/library.html" class="external-link">library("doRedis")
registerDoRedis("jobs")
startLocalWorkers(n = 4, queue = "jobs")
</a></code></pre>
</td>
<td>
N/A. There is currently no known Redis-based future backend and therefore no known doFuture alternative to the <a href="https://cran.r-project.org/package=doRedis" class="external-link">doRedis</a> package.
</td>
</tr>
<table class="table">
<div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>





      <footer><div class="copyright">
  <p></p>
<p>Developed by Henrik Bengtsson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001 and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9001.</p>
</div>

      </footer><script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'aa6e02fc501886fb0f7c91ac4e300456',
    indexName: 'futureverse',
    algoliaOptions: { 'facetFilters': ['project:doFuture'] },
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</table>
</table>
</div>
</div>
</div>
</div>
</body>
</html>
